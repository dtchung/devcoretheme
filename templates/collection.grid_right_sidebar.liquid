<!-- Created by Andy 21/06/2017 -->
<script>
  var json_collection_filter =  {{collection.products | json }};
  var json_wishlist = [];
  var json_product_tag = [];
  var json_email = [];
  {% if customer %}
  
    {% capture tags %}{% for tag in customer.tags %}{{ tag }} {% endfor %}{% endcapture %}
    {% assign tags = tags | remove:'x' | split:' ' | uniq | join:' ' %}
    {% for product in collection.products %}
        		
        {% if tags contains product.id %}
          	{% for tag in customer.tags %}
              {% if tag contains product.id %}
                  {% assign t = tag %}  				

              {% endif %}
          	{% endfor %}
  			json_product_tag.push("{{t}}");			
  
        	{% assign check = t.size | minus:product.id.size | modulo:2 %}
        	{% assign  check_mod =  t.size | modulo :2   %}
        	{% if check == 0 or check_mod == 0  %}
			 	json_wishlist.push({{t | remove: 'x'}});
			{% endif %} 
  		{% else %}
  			json_product_tag.push("{{product.id}}");
  		{% endif %}
    {% endfor %} 
  		json_email.push("{{customer.email}}");
                                  
   {%else%}  
     
      {% for product in collection.products %}
            json_product_tag.push("{{product.id}}");
      {% endfor %}                             
                                  
  {% endif %}
</script>


<div class="main-container shop-page right-slidebar">
   <div class="container">
    <div class="breadcrumbs">
      <a href="/">Home</a> / {%if collection.handle != 'all'%} {{collection.title | link_to: collection.url}} {% else %}{{ 'Shop'| link_to: collection.url}} {% endif %}
    </div>
    <div class="row">
      
      {% paginate collection.products by settings.pagination_limit %}
      <div class="col-xs-12 col-sm-7 col-md-8 col-lg-9 content-offset">       
        <div id="primary" class="js_categories_content">
          <h4 class="shop-title">{{collection.title }}</h4>
          <div class="top-control box-has-content">
            <div class="control">
              <div class="filter-choice">
                {% include 'collection-sorting' %}                   
              </div>
              
              <div class="select-item">
                {% include 'collection-number-pagination' %}  
              </div>
              
              {% assign view_mod = "grid" %}
              {% include 'collection-views' %}              
              
            </div>
          </div>
          <div class="nt_svg_loader"></div>
          <div class="js_container_cat grid-style"> 
            {%- assign get_url = '' | link_to_remove_tag: '' | split:'href="' | last | split:'"' | first -%}
            <div id="collection-product" class="js_products_holder products product-container" data-first="/collections/" data-category="{{get_url | split:'?' | first | split:'/collections/' | last | split:'/' | first}}" data-tag="{{get_url | split:'?' | first | split:'/collections/' | last | split:'/' | last}}" data-last="{{get_url | split:'?' | last}}">
              
            {% assign view_mod = "grid" %}
            {% for product in collection.products %}              
              {% include 'product-grid-item' %}              
            {% endfor %} 
            </div>
            <div class="bot_page_collection">
            {% if paginate.pages > 1 %}
            <nav class="pagination js_paginate_ajax">      
              {%comment%}{{ paginate | default_pagination | replace: '&laquo; Previous', '&larr;' | replace: 'Next &raquo;', '&rarr;' }}{%endcomment%}
              <ul class="page-numbers list-page">

                {% if paginate.previous.is_link %}
                	<li> <a class="nav-button page-numbers" href="{{ paginate.previous.url }}#primary">{{ paginate.previous.title }}</a></li>           
                {% endif %}

                {% assign i=1 %}
                {% for i in (1..paginate.pages) %}
                    {% if paginate.current_page == i %}
                        <li><a href="javascript:void(0)" class="page-number current">{{i}}</a></li>
                    {% else %}
                        {% assign index = i | plus:0 %}
                        {% assign index = index | minus:1 %}
                        {% if paginate.parts[index].is_link == true %}
                        <li><a class="page-number" href="{{paginate.parts[index].url}}#primary">{{paginate.parts[index].title}}</a></li>
                    {% endif %}
                    {%endif%}
                {% endfor %}

                {% if paginate.next.is_link %}
                <li> <a class="nav-button page-numbers" href="{{ paginate.next.url }}#primary">{{ paginate.next.title }}</a></li>           
                {% endif %}
              </ul>
            </nav>
            {% endif %} 
            {% assign val_1 = paginate.current_offset%}
              {% assign val_2 = val_1 | plus: paginate.page_size %}
              {% if val_2 > paginate.items %}
              {% assign val_2 = paginate.items %}
              {% endif %}
              <span class="note products-result-count">Showing {% if paginate.items >0 %}{{val_1 | plus:1}}{% else %} {{val_1}} {% endif %}&ndash;{{val_2}} of {{paginate.items}}</span>
        	</div>            
          </div>
        </div>
        {% endpaginate %}  
      </div>
      {% include 'collection-sidebar'%}
    </div>
  </div>

</div>